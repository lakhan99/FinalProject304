---
title: "Obesity and how to prevent it"
subtitle: 
author: 
  - Arsh Lakhanpal
thanks: "Code and data are available at: https://github.com/lakhan99"
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "This paper will study to correlation between eating habits and activities that an individual takes part in throughout their day. We observe that the the individuals meals per day, their physical activity frequency, their consumption of food between meals and consumption of alcohol to be the main factors which attributed to higher BMIs. This is significant because it can inform the readers about activities they can do or not do to live a healthy life. The consequences of obesity go past one's physical health, it includes their mental health, sleep and the environment.\\par\\textbf {Keywords:} obesity, body mass index, weight, food, health"
output:
  bookdown::pdf_document2
toc: FALSE
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

#install.packages('bookdown')
#install.packages('car')
library(tidyverse)
library(readr)
library(bookdown)
library(car)
library(dplyr)
ObesityDataSet_raw_and_data_sinthetic <- read_csv("~/starter_folder-main/inputs/data/ObesityDataSet_raw_and_data_sinthetic_final.csv")
obesity_data <- ObesityDataSet_raw_and_data_sinthetic

obesity_data$new_FAVC <- as.numeric(as.character(factor(obesity_data$FAVC,
                                                        levels = c('yes', 'no'), labels = c(1,0))))

obesity_data$new_SCC <- as.numeric(as.character(factor(obesity_data$SCC,
                                                        levels = c('yes', 'no'), labels = c(1,0))))

obesity_data$new_history <- as.numeric(as.character(factor(obesity_data$family_history_with_overweight,
                                                        levels = c('yes', 'no'), labels = c(1,0))))

obesity_data$new_CAEC <- as.numeric(as.character(factor(obesity_data$CAEC,
                                                        levels = c('Always', 'Frequently', 'Sometimes', 'no'), labels = c(3,2,1,0))))


obesity_data$new_CALC<- as.numeric(as.character(factor(obesity_data$CALC,
                                                        levels = c('Always', 'Frequently', 'Sometimes', 'no'), labels = c(3,2,1,0))))

obesity_data$new_FAF<- ifelse(obesity_data$FAF == 3, "4 or 5 days",
                              ifelse(obesity_data$FAF== 2, "2 or 4 days",
                                     ifelse(obesity_data$FAF==1, "1 or 2 days",
                                            ifelse(obesity_data$FAF == 0, "Doesn't work out",1)))) 

obesity_data$new_MTRANS <- as.numeric(as.character(factor(obesity_data$MTRANS,
                                                        levels = c('Automobile', 'Motorbike', 'Public_Transportation', 'Walking', 'Bike'), labels = c(4,3,2,1,0))))

obesity_data$class <- ifelse(clean$BMI >= 25 & clean$BMI < 30, "Overweight",
                              ifelse(clean$BMI >= 18.5 & clean$BMI < 25, "Healthy Weight",
                                     ifelse(clean$BMI < 18.5, "Underweight",
                                            ifelse(clean$BMI >= 30, "Obese",1))))

obesity_data <- obesity_data %>% mutate(BMI = Weight/(Height^2))
obesity_data <- subset(obesity_data, select = -...18)

clean <- na.omit(obesity_data)

set.seed(1)
train <- clean[sample(1:nrow(clean), 1056, replace = F), ]
test <- clean[which(!(clean$Indicator %in% train$Indicator)),]

```

```{r}
#Are people who track their calories more likely to be normal weight than people who dont?
#Look at of the amount of people who don't track their calories, how many are obese according to BMI. 
#Of the 974 people who are obese, only 3 of them count their calories
#of 300 people in a healthy weight range, 37 of them count their calories 
#Of 556 people who are overweight, 34 of them count their calories 



clean %>% filter(SCC == 'no')
clean %>% count(clean$SCC)


filtered_obese <- clean %>%  filter(clean$BMI >= 30)
filtered_obese %>% count(filtered_obese$SCC == 'no')

overweight <- clean %>% filter(clean$BMI >= 25 & clean$BMI < 30)
overweight %>% count(overweight$SCC =='no')


not_obese <- clean %>% filter(clean$BMI >= 18.5 & clean$BMI < 25)
not_obese %>% count(not_obese$SCC =='yes')
```

```{r}
family_history <- ggplot(data = clean, 
                         mapping = aes_(x = clean$family_history_with_overweight, fill = clean$NObeyesdad))+
  geom_bar(position = 'stack') + coord_flip()

family_history
```
```{r}
#Obesity cases when diet is taken into account
#Filter BMI of more than 28 to ensure we are looking at obese cases

overweight_obese <- clean %>% filter(BMI > 25) 

count(overweight_obese %>% filter(overweight_obese$new_FAVC == '1' & overweight_obese$CH2O < 2))
count(not_obese %>% filter(not_obese$new_FAVC == '1' & not_obese$CH2O < 2))


#count(clean %>% filter(clean$new_FAVC & clean$CH2O))

#397 of them are on the higher end of overweight and or obese compared to only 71 people with the same eating habits being normal weight. 

count(not_obese %>% filter(not_obese$new_FAVC=='0' & not_obese$CH2O >= 2 & not_obese$FCVC >=2))
count(overweight_obese %>% filter(overweight_obese$new_FAVC=='0' & overweight_obese$CH2O >= 2 & overweight_obese$FCVC >=2))

count(clean %>% filter(clean$new_FAVC=='0' & clean$CH2O >= 2 & clean$FCVC >=2))


```
```{r}
#obesity cases in relation to how much an individual works out and their caloric consumption in obese and not obese weight groups 
ggplot(data = overweight_obese, mapping = aes_(x = overweight_obese$new_FAF, fill = overweight_obese$FAVC)) +geom_bar()

ggplot(data = not_obese, mapping = aes_(x = not_obese$new_FAF, fill = not_obese$FAVC)) + geom_bar()


#Eating between meals is a good thing 
ggplot(data = overweight_obese, mapping = aes_(x = overweight_obese$new_FAF, fill = overweight_obese$CAEC)) +geom_bar()
ggplot(data = not_obese, mapping = aes_(x = not_obese$new_FAF, fill = not_obese$CAEC)) + geom_bar()
```
```{r}
#Impact of food, obese but workout often 

count(overweight_obese %>% filter(overweight_obese$FAF >= 2))
count(not_obese %>% filter(not_obese$FAF >= 2))

count(clean %>% filter(clean$FAF >= 2))
```


```{r}

model_1 <- lm(BMI ~ new_FAVC+ new_CAEC + new_history + FAF + Age + MTRANS , data = train)
summary(model_1)

res_model1 <- resid(model_1)

#plot(train$age ~ train$serum_sodium, main = "Serum Sodium versus Age", xlab= "Age", ylab = "Serum Sodium")
plot(train$BMI ~ fitted(model_1), main = "Response versus Fitted Values", xlab= "Fitted Values", ylab = "Platelets")

plot(res_model1 ~ fitted(model_1), main = "Residuals versus Fitted Values", xlab= "Fitted Values", ylab = "Residuals")

plot(res_model1 ~ train$Age, main = "Residuals versus Age", xlab= "Age", ylab = "Residuals")
#plot(res_model1~ train$Height, main = "Residuals versus Serum Sodium", xlab= "Serum Sodium", ylab = "Residuals")
```

```{r}
boxCox(model_1)

train_select <- train %>% select(BMI,Weight, new_FAVC, new_CAEC, new_history, FAF, Age, MTRANS)
#train_select %>% unlist(train_select$BMI, train_select$Weight)

train_box <- train_select %>% mutate(BMI_box = BMI^(1/3))

model_box <- lm(BMI_box ~ new_FAVC+ new_CAEC + new_history + FAF + Age + MTRANS, data = train_box)
summary(model_box)

res_box <- resid(model_box)
plot(train_box$BMI_box ~ fitted(model_box), main = "Response versus Fitted Values", xlab= "Fitted Values", ylab = "Platelets")





p <- powerTransform(cbind(unlist(train_select[,1]),unlist(train_select[,2]))~1)

summary(p)

train_power <- train_select %>% mutate(BMI_power = BMI^0.5, Weight_power = Weight^(1/3))

model_power <- lm(BMI ~ new_FAVC+ new_CAEC + new_history + FAF + Weight_power , data = train_power)
summary(model_power)

res_power <- resid(model_power)
plot(train_power$BMI ~ fitted(model_power), main = "Response versus Fitted Values", xlab= "Fitted Values", ylab = "Platelets")




```



# Introduction

Obesity is defined as the "abnormal or excessive fat accumulation that presents a risk to health [citation]" Although not as large a problem in previous years, as of 2017, over 4 million people have died as a result of obesity. According to the World Health Organization, an individual with a body mass index (referred to as BMI) that is greater than 30 is considered obese and an individual with a BMI greater than 25 is overweight [citation]. Similarly a BMI of less than 18.5 suggests that the individual is underweight. This value is calculated by dividing the individuals weight in kilograms by the square of their height which is measured in meters[citation]. The reason that BMI will be used in this paper is because of the fact that it accounts for the height of an individual which provides a standard for us to compare people with different heights[citation]. This allows results of this study to be relevant as height also is a determining factor in an individuals weight.     

In this report, from data collected from individuals living in Peru, Mexico and Columbia, I plan to examine various factors and determine their significance in a person being overweight or obese. I start out my data section by creating a number of graphs and studying a lot of the variables from the data set. From this, I am able to identify the most significant variables that play a role in an individual having a higher weight. To be precise, this is because from the formula of BMI, a higher weight would indicate a higher BMI and thus resulting in someone being overweight or obese. With the variables that are most significant, I construct a linear model. With the benchmarks set by the BMI, this model could be used in determining what factors and the severity of those factors play a role in someone being overweight or obese. 

"add more when more graphs"

Section 2 of this paper talks more about where and how the data was collected and if any modifications were made to this data set for the purpose of this study. This includes the construction of new variables such as "BMI" and removal of other variables. In section 3 of this paper, we will make a linear model of our data and discuss the results of our study. Section 4 talks about the limitations of this study using a measure like BMI and possible ethical concerns the reader consider before making any sort of decision.    




```{r}
#You can and should cross-reference sections and sub-sections. For instance, Section \@ref(data). R Markdown automatically makes the sections lower case and adds a dash to spaces to generate labels, for instance, Section \@ref(first-discussion-point). 
```



# Data

This dataset was obtained from the UCI Machine Learning Repository and was donated on August 27, 2019 [citation]. It consists of 17 variables and 2111 observations, all based of individuals aged 14-61 who lived in Mexico, Peru and Colombia. This data set was used for a paper by Fabio Palechor and Alexis Manotas in which they simply presented the data that was collected []. The responses were conducted using surveys which can be found in the appendix of this paper. I worked on this data on R [citation] and used readr[] to help load the data. Other packages such as tidyverse[] and dplyr[] were used to clean the data whereas ggplot2 [] was used to construct the graphs in this paper. Finally, the linear model was created using the stats package, something included in base R and the car package [].     

## Data Cleaning and Modifications 

The raw data for this dataset did not contain any empty or ambiguous responses however, I did run the code to omit any "N/A's" that may have been in the dataset. The gender variable was also removed since it was insignificant to the study being conducted. Although women are more likely to become obese in comparison to men in general, this statistic does vary for many countries [https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3649717/]. Along with that, this paper aims to focus on decisions people make in their day-to-day lives which involve their diet and physical activity, something which is accessible to both genders included in the study. 

Variables with an individuals height, weight, age and their family history with obesity were included in the data along with responses about their eating habits. These included their,  

* Consumption of high caloric food
* Frequent consumption of vegetables
* Consumption of food between meals
* Consumption of water daily 
* Consumption of Alcohol

There were also questions on their physical habits. The habitual questions were based on their:

* Calorie consumption monitoring 
* Transportation Method Used 
* Physical activity frequency
* Time using technological devices


There were various modifications that needed to be done for the data. The first modification was creating the "BMI" variable as the dataset itself only consisted of the variable in which it stated the weight class for every individual. To do this, as per the formula to calculate BMI, every individuals weight (kilograms) was divided by the square of their height (metres). This variable was important for the modeling part of this section as the response variable for this study had to be a numerical value. Once the BMI variable was created, the age and height variables were removed from the dataset as our model focuses on predicting a specific proportion between these variables and so, neither of these variables could be used as predictors for the model. Other variables that were created were those which pertained to whether or not an individual consumed high caloric food frequently, their consumption of food between meals, their family history with obesity, their consumption of alcohol and their method of transportation. These were all variables that were in the dataset however to use these variables in our linear model, we had to give numerical values to the responses that were recorded. The response for an individuals family history with obesity was either "yes" or "no" and the new variable simply records these as "1" and "0" respectively. Similarly, for the response about method of transportation, the responses "Automobile," "Motorbike," "Public Transportation," "Walking," and "Biking" were all given respective values of "5," "4," "3," "2," and "1" with the assumption that biking instead of driving to work is more beneficial to one's health. The other variables created were also created with this assumption. A variable for frequency of physical activity was also created which took responses in the numeric form to responses such as "4 to 5 days" which helped with Figure #insert figure.# Finally, an indicator variable was created to aid with splitting our data into training and test data sets for model validation.   

## Data Visualization

There were only two numeric variables in this dataset that we could visualize being BMI and Age of the population. From the Figure 1, we see a very strong right skew in terms of the distribution of the variable. This is something important to consider as this suggests that the majority of the population is young meaning that the results of this study would be based on habits of a younger individual. Any conclusions made would have to be made with this in mind. Since we are considering the different classes the BMI would put one in, the weights are also highlighted. The trends we see make sense since as one gets older, they begin to care about their weight more and actively take steps to reduce their weight. This is shown as the proportion of obese and overweight individuals decrease as we consider the higher age ranges. Looking at the relation between age and BMI as shown in Figure 2 , due to the right skew of the age variable, a majority of the points are situated on the left side of the graph however, the higher ages are generally associated with lower levels of BMI. Finally, Figure 3 is a histogram of the BMI variable where we notice a multi-modal distribution with various peaks in all classes, the highest one being in the overweight class.              


```{r}
#Age histogram shows that the age of the sample being studied is highly skewed right 
#Not any visible pattern, slight pattern suggesting higher age would yield lower BMI. 

ggplot(data = clean, aes( x = Age, fill = clean$class)) + geom_histogram()
ggplot(data = clean, aes(x = Age, y = BMI)) + geom_point()
#summary(lm(BMI~ Age, data = clean))



ggplot(data = clean, aes( x = BMI, fill = class)) + geom_histogram()


```





```{r bills, fig.cap="Bills of penguins", echo = FALSE}

#Our data is of penguins (Figure \@ref(fig:bills)).
```



```{r billssssss, fig.cap="More bills of penguins", echo = FALSE, fig.width=8, fig.height=4}

# This needs to be about the random data tha tI sasmpled?

```





# Model

The purpose of the model is to be able to find the most relevant predictors that can affect one's BMI. Since BMI is a numeric response variable, linear regression seemed to be the correct choice of model as opposed to a logistic regression which is more beneficial when the response variable is binary. 

As stated in the data section, the new variable BMI was created for this and many of the responses were re-coded to have number values with the understanding that the higher numbers are indicative of actions that are more likely to increase one's BMI. To decide which model was best, the backwards selection method method was used with the significance level of 0.01. Along with this, research on healthy eating habits was also done to determine which predictors were most important significant to appropriately create the model. After applying the backwards selection technique on      



```{r}
model_full <- lm(BMI ~ new_history + new_FAVC + FCVC + NCP + new_CAEC + CH2O + new_SCC + FAF + TUE + new_CALC +new_MTRANS, data = train)
summary(model_full)
#Drop CH2O since it had the highest p-value in the model.

model_noH2O <- lm(BMI ~ new_history + new_FAVC + FCVC + NCP + new_CAEC + new_SCC + FAF + TUE + new_CALC +new_MTRANS, data = train)
summary(model_noH2O)

#Drop NCP since it had higest P-value 

model_noNCP <- lm(BMI ~ new_history + new_FAVC + FCVC + new_CAEC + new_SCC + FAF + TUE + new_CALC +new_MTRANS, data = train)
summary(model_noNCP)

```


```{r}
model_1 <- lm(BMI ~ new_FAVC+ new_CAEC + new_history + FAF + Age + MTRANS , data = train)
summary(model_1)

res_model1 <- resid(model_1)

#plot(train$age ~ train$serum_sodium, main = "Serum Sodium versus Age", xlab= "Age", ylab = "Serum Sodium")
plot(train$BMI ~ fitted(model_1), main = "Response versus Fitted Values", xlab= "Fitted Values", ylab = "Platelets")

plot(res_model1 ~ fitted(model_1), main = "Residuals versus Fitted Values", xlab= "Fitted Values", ylab = "Residuals")

plot(res_model1 ~ train$Age, main = "Residuals versus Age", xlab= "Age", ylab = "Residuals")
#plot(res_model1~ train$Height, main = "Residuals versus Serum Sodium", xlab= "Serum Sodium", ylab = "Residuals")
```

```{r}
boxCox(model_1)

train_select <- train %>% select(BMI,Weight, new_FAVC, new_CAEC, new_history, FAF, Age, MTRANS)
#train_select %>% unlist(train_select$BMI, train_select$Weight)

train_box <- train_select %>% mutate(BMI_box = BMI^(1/3))

model_box <- lm(BMI_box ~ new_FAVC+ new_CAEC + new_history + FAF + Age + MTRANS, data = train_box)
summary(model_box)

res_box <- resid(model_box)
plot(train_box$BMI_box ~ fitted(model_box), main = "Response versus Fitted Values", xlab= "Fitted Values", ylab = "Platelets")





p <- powerTransform(cbind(unlist(train_select[,1]),unlist(train_select[,2]))~1)

summary(p)

train_power <- train_select %>% mutate(BMI_power = BMI^0.5, Weight_power = Weight^(1/3))

model_power <- lm(BMI ~ new_FAVC+ new_CAEC + new_history + FAF + Weight_power , data = train_power)
summary(model_power)

res_power <- resid(model_power)
plot(train_power$BMI ~ fitted(model_power), main = "Response versus Fitted Values", xlab= "Fitted Values", ylab = "Platelets")

```


# Results

# Discussion

BMI not the perfect measure
Doesn't take into account that muscle weighs more than fat 
Doesn't account for mood? 

definition of "always" 

## First discussion point

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional details


\newpage


# References


